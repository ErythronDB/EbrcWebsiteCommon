#!/usr/bin/perl
use strict;
my $branch = $ARGV[0];

my @projects = ('ApiCommonData:apidb', 'ApiCommonShared:apidb', 'ApiCommonWorkflow:apidb', 'CBIL:gus', 'DoTS:apidb', 'EuPathDatasets:apidb', 'FgpUtil:gus', 'GGTools:apidb', 'GusAppFramework:gus', 'GusSchema:gus', 'install:gus', 'OrthoMCLData:apidb', 'OrthoMCLEngine:apidb', 'OrthoMCLShared:apidb', 'ReFlow:gus', 'WDK:gus', 'WSF:gus');

usage() unless $branch;

my $url = 'https://www.cbil.upenn.edu/svn';
foreach my $project (@projects) {
  my ($name, $repository) = split(/:/, $project);
  my $subTarget = $branch eq 'trunk'? "trunk" : "branches/$branch";
  my $target = "$url/$repository/$name/$subTarget";
  my $dirName = $name;
  $dirName = "GUS" if $dirName eq 'GusAppFramework';
  my $cmd = "svn co $target $dirName";
  print STDERR "$name\n";
  system($cmd) == 0 || die "Failed checking out '$name'\n";
}

sub usage {
  print STDERR "

Check out a specified branch of the EuPathDB backend software into the current dir.

cd to target \$PROJECT_HOME first.

usage: eupathBackendCheckout trunk|branch_number

Checks out the following projects:
";
  foreach my $project (@projects) {
    my ($name, $repository) = split(/:/, $project);
    print STDERR "  $name\n";
  }
exit(1);
}
